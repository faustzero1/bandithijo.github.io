I"+<h1 id="step-4--set-up-bootloader">STEP 4 : Set up Bootloader</h1>

<h2 id="41-install-bootloader-systemd-boot">4.1 Install Bootloader (systemd-boot)</h2>

<p>Saya memilih menggunakan <code class="highlighter-rouge">systemd-boot</code> ketimbang <code class="highlighter-rouge">GRUB</code> karena lebih mudah buat saya pahami. Sebelumnya <code class="highlighter-rouge">systemd-boot</code> ini bernama <code class="highlighter-rouge">gummiboot</code>, saya gunakan juga pada mesin MacBook Pro 8.1 (<em>late</em> 2011). Menurut saya <code class="highlighter-rouge">systemd-boot</code> ini lebih sederhana dan simpel, serta sudah termasuk dalam paket <code class="highlighter-rouge">systemd</code>, yang mana sudah terpasang secara <em>default</em> bersama <em>base system</em> Arch.</p>

<p>Instalasi <code class="highlighter-rouge">systemd-boot</code> ke <code class="highlighter-rouge">/dev/sda1</code> yang telah di-_mount_ ke <code class="highlighter-rouge">/mnt/boot</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># bootctl ––path=/boot install
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Created “/boot/EFI”.
Created “/boot/EFI/systemd”.
Created “/boot/EFI/BOOT”.
Created “/boot/loader”.
Created “/boot/loader/entries”.
Copied “/usr/lib/systemd/boot/efi/systemd-bootx64.efi” to “/boot/EFI/systemd/systemd-bootx64.efi”.
Copied “/usr/lib/systemd/boot/efi/systemd-bootx64.efi” to “/boot/EFI/BOOT/BOOTX64.EFI”.
Created EFI boot entry “Linux Boot Manager”.
</code></pre></div></div>

<p>Pastikan **tidak terjadi **<em><strong>error</strong></em> seperti “<em>File system “/boot” is not a FAT EFI System Partition (ESP) file system.</em>”. Apabila terjadi <em>error</em> seperti ini, maka besar kemungkinan terjadi kesalahan pada saat <em>mounting partition</em> (Step 3.1). Kamu bisa kembali melakukan <em>mounting</em> ulang dengan terlebih dahulu keluar dari <code class="highlighter-rouge">chroot</code> =&gt; <code class="highlighter-rouge"># exit</code>.</p>

<h2 id="42-bootloader-configuration">4.2 Bootloader Configuration</h2>

<p>Setelah <code class="highlighter-rouge">systemd-boot</code> berhasil terpasang, langkah selanjutnya adalah mengkonfigurasi <em>file</em> <code class="highlighter-rouge">loader.conf</code> dan membuat <code class="highlighter-rouge">arch.conf</code>.</p>

<p>Langkah ini membutuhkan <em>text editor</em>. Saya terbiasa menggunakan <code class="highlighter-rouge">vim</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># pacman -S vim
</code></pre></div></div>

<p>Sekarang, saatnya kita mengedit <em>file</em> <code class="highlighter-rouge">/boot/loader/loader.conf</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vim /boot/loader/loader.conf
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#timeout 3
#console-mode keep
default 2b7aac817eaf45d9b71a8f0e5ea8b942-*
</code></pre></div></div>
<p>Saya akan komentar saja baris <code class="highlighter-rouge">default ...</code></p>

<p>Kemudian isikan seperti contoh yang ada di bawah.</p>

<pre>
#timeout 3
#console-mode keep
<mark>#</mark>default 2b7aac817eaf45d9b71a8f0e5ea8b942-*
<mark>default arch
timeout 0</mark>
</pre>

<!-- PERHATIAN -->
<div class="blockquote-red">
<div class="blockquote-red-title">[ ! ] Perhatian</div>
<p>Secara <i>default</i>, file <code>loader.conf</code> sudah terdapat isi di dalamnya. Kita dapat menghapus isi sebelumnya dan mengganti atau isikan persis sama seperti contoh di atas. Untuk isi dari <code>default</code> penamaan harus sama dengan file preferensi yang akan kita buat pada langkah selanjutnya (di bawah). Saya menggunakan nama yang simple, yaitu <code>arch</code> , yang nantinya akan dibuatkan file bernama <code>arch.conf</code>.</p>
<p><code>timeout 3</code> nilai ini dapat kalian sesuaikan dengan preferensi kalian masing-masing. Saya biasanya menggunakan nilai <code>1</code> atau bahkan <code>0</code>.</p>
<p>Karena saya tidak memerlukan untuk melihat <i>boot selection</i>.</p>
</div>

<p>Apabila sudah dipastikan tidak terdapat <em>typo</em>, kalian dapat keluar dari Vim.</p>

<p>Tahap selanjutnya terlebih dahulu siapkan <em>smartphone</em> atau kertas dan pulpen untuk mencatat nomor UUID.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># blkid -s UUID -o value /dev/sda2
</code></pre></div></div>

<p>Catat atau untuk menghindari kesalahan, foto saja nomor UUID yang tampak di layar agar lebih mudah.</p>

<p>Kemudian kita akan membuat <em>file</em> <code class="highlighter-rouge">arch.conf</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vim /boot/loader/entries/arch.conf
</code></pre></div></div>

<p>Isikan persis sama seperti yang tertulis di bawah.</p>

<pre>
title Arch Linux
linux /vmlinuz-linux
initrd /initramfs-linux.img
options cryptdevice=UUID=<mark>56fdc3fa-8a1c-4d4e-a13f-4af99bf6ae6a</mark>:volume root=/dev/mapper/volume-root rw
</pre>

<p>Ganti <code class="highlighter-rouge">UUID=56fdc3fa-8a1c-4d4e-a13f-4af99bf6ae6a</code> dengan UUID milikmu. Jangan sampai ada yang <em>typo</em>. Harus benar-benar sama persis.</p>

<p>Apabila terjadi  kesalahan dapat menyebabkan sistem operasi yang tersimpan pada <code class="highlighter-rouge">/dev/sda2</code> tidak dapat di-<em>load</em> ke dalam RAM.</p>

<!-- INFORMATION -->
<div class="blockquote-blue">
<div class="blockquote-blue-title">[ i ] Informasi</div>
<p>Kalau menggunakan Vim, dapat menggunakan cara yang lebih mudah ini.</p>
<p>Buat baris baris baru di bawah <code>options</code>, <kbd>Shift</kbd>+<kbd>O</kbd>.</p>
<p>Lalu masukkan command di bawah.</p>
<pre>
:r! blkid -s UUID -o value /dev/sda2
</pre>
<p>Nanti akan menghasilkan <i>output</i> berupa <code>UUID</code> dari <code>/dev/sda2</code>.</p>
<p>Asik bukan.</p>

</div>

<p>Setelah dipastikan tidak terdapat <em>typo</em>, kita dapat menyimpannya dan keluar dari Vim.</p>

<p>Kemudian lakukan <em>update</em> <code class="highlighter-rouge">systemd-boot</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># bootctl update
</code></pre></div></div>
<p>Outputnya adalah,</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Copied "/usr/lib/systemd/boot/efi/systemd-bootx64.efi" to "/boot/EFI/systemd/systemd-bootx64.efi"
Copied "/usr/lib/systemd/boot/efi/systemd-bootx64.efi" to "/boot/EFI/BOOT/BOOTX64.EFI"
</code></pre></div></div>

<p>Karena kita menggunakan partis LVM yang terenkripsi, untuk itu kita perlu mengedit <em>file</em> <code class="highlighter-rouge">/etc/mkinitcpio.conf</code> agar kita dapat menggunakan <em>keyboard</em> untuk memasukkan <em>password</em> sebelum <em>filesystems</em> di-<em>load</em> lebih dahulu.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vim /etc/mkinitcpio.conf
</code></pre></div></div>

<p>Cari baris yang bertuliskan <code class="highlighter-rouge">HOOKS=(base udev dst... )</code>. Biasanya pada baris 52.</p>

<pre>
...
...

HOOKS=(base udev autodetect modconf block filesystems <mark>keyboard</mark> fsck)
...
...
</pre>

<p>Pindahkan <code class="highlighter-rouge">keyboard</code> setelah <code class="highlighter-rouge">block</code> dan tambahkan <code class="highlighter-rouge">encrypt</code> dan <code class="highlighter-rouge">lvm2</code>, seperti contoh di bawah ini.</p>

<pre>
...
...

HOOKS=(base udev autodetect modconf block <mark>keyboard encrypt lvm2</mark> filesystems fsck)
...
...
</pre>

<p>Setelah kalian memastikan tidak terdapat <em>typo</em>, kalian dapat simpan dan keluar dari Vim.</p>

<p>Langkah terakhir pada proses <em>bootloader configuration</em> ini adalah, <em>update</em> <code class="highlighter-rouge">initramfs</code> dengan cara sebagai berikut.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># mkinitcpio -p linux
</code></pre></div></div>

<p>Untuk kalian yang menggunakan <em>processor</em> Intel. Sebaiknya kita menambahkan paket yang bernama <code class="highlighter-rouge">intel-ucode</code>. Kegunaannya dapat dibaca <a href="https://wiki.archlinux.org/index.php/Microcode">di sini</a>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># pacman -S intel-ucode
</code></pre></div></div>

<p>Kemudian tambahkan <code class="highlighter-rouge">initrd /intel-ucode.img</code> pada file <code class="highlighter-rouge">/boot/loader/entries/arch.conf</code> seperti contoh di bawah.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vim /boot/loader/entries/arch.conf
</code></pre></div></div>

<pre>
title Arch Linux
linux /vmlinuz-linux
<mark>initrd /intel-ucode.img</mark>
initrd /initramfs-linux.img
options cryptdevice=UUID=56fdc3fa-8a1c-4d4e-a13f-4af99bf6ae6a:volume root=/dev/mapper/volume-root rw
</pre>

<p>Setelah kalian memastikan tidak terdapat <em>typo</em>, kalian dapat simpan dan keluar dari Vim.</p>

<p>Kemudian lakukan <em>update</em> <code class="highlighter-rouge">systemd-boot</code> dan <em>generate</em> <code class="highlighter-rouge">mkinitcpio</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># bootctl update
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># mkinitcpio -p linux
</code></pre></div></div>

<p>Langkah di atas kita lakukan karena kita menggunakan <code class="highlighter-rouge">systemd-boot</code>. Untuk <em>bootloader</em> <code class="highlighter-rouge">GRUB</code>, hanya tinggal melakukan <em>regenrate</em> <code class="highlighter-rouge">grub-mkconfig</code> saja. Namun, saya kurang begitu memahaminya.</p>

<p>Sampai di sini, apabila kita <em>reboot</em>, sebenarnya kita sudah dapat masuk ke dalam Arch sistem.</p>

<p>Namun, sistem kita masih belum lengkap karena kita perlu melakukan beberapa konfigurasi dasar yang diperlukan oleh sebuah sistem operasi. Seperti, <em>locale</em>, <em>hostname</em>, <em>username</em>, <em>password</em>, <em>zoneinfo</em> <em>time</em>, dll.</p>

<p>Untuk itu, sementara kita lanjutkan saja pada <em>session</em> ini. Dan jangan <em>reboot</em> dahulu, nanti susah lagi konek internetnya (sebenarnya gampang aja, via <em>usb tethering</em>).</p>

<!-- NEXT PREV BUTTON -->
<div class="post-nav">
<a class="btn-blue-l" href="/arch/step-3-installing-arch-linux-base-packages"><img style="width:20px;" src="/assets/img/logo/logo_ap.png" /></a>
<a class="btn-blue-c" href="/arch/"><img style="width:20px;" src="/assets/img/logo/logo_menu.svg" /></a>
<a class="btn-blue-r" href="/arch/step-5-set-language-and-time-zone"><img style="width:20px;" src="/assets/img/logo/logo_an.png" /></a>
</div>
:ET