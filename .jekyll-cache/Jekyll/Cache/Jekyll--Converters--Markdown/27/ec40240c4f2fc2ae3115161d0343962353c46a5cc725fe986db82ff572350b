I"ˆ*<h1 id="bonus-backup-restore--recovery">Bonus: Backup, Restore &amp; Recovery</h1>

<h2 id="backup">Backup</h2>

<p>Mungkin sebagian dari teman-teman sudah sangat familiar dan mempunyai cara sendiri dalam melakukan backup terhadap data-data yang dimiliki.</p>

<p>Pada part ini saya akan berbagi informasi bagaimana cara saya melakukan backup. Saya sangat menyadari bahwa mungkin cara yang saya dalam melakukan backup, bukan merupakan cara yang baik dan benar. Dengan keterbatasan ilmu saya saat menulis dokumentasi ini, maka cara ini yang masih saya pergunakan.</p>

<p><strong>Pertama</strong>, kita membutuhkan partisi backup dengan kapasitas sebesar partisi root.</p>

<p>Bagaimana caranya ?</p>

<ol>
  <li>Siapkan satu buah hard disk minimal berkapasitas yg sama dengan partisi root, atau dapat juga berkapasitas lebih besar.</li>
  <li>Apabila ingin menggunakan hard disk external yang sudah ada, maka siapkan satu buah partisi backup sebesar partisi root atau lebih besar.</li>
</ol>

<p><strong>Kedua</strong>, format partisi sekaligus memberikan memproteksi dengan LUKS enkripsi agar data-data backup kita tidak dapat dibuka oleh orang lain dengan mudah.</p>

<p>Bagaimana caranya ?</p>

<p>Buka aplikasi <strong>GNOME Disks</strong> (<code class="highlighter-rouge">gnome-disk-utility</code> â€“ Disk management utility for GNOME).</p>

<p><img src="/assets/img/logo/logo_blank.svg" alt="" data-echo="/assets/Gambar 2.png" /></p>

<p>Gambar 2 - GNOME Disks</p>

<p>Seperti yang kalian lihat pada Gambar 2, saya mempunyai hard disk berkapasitas 1 TB, dengan tiga buah partisi.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. 540 GB | /dev/sdb1 | Partition 1         | LUKS Encryption
2. 250 GB | /dev/sdb2 | Partition 2         | LUKS Encryption
3. 215 GB | /dev/sdb3 | BANDITHIJO-NTFS    | NTFS
</code></pre></div></div>

<p>Terdapat dua partisi dengan LUKS Encryption, yaitu <strong>Partition 1</strong> dan <strong>Partition 2</strong>. Ini adalah contoh dari bentuk partisi yang telah dipasang LUKS. Bisa dilihat pada <strong>Contents :</strong> (paling bawah), terdapat status <strong>Locked</strong>. Maksudnya, apabila partisi ini di_mounting_, kita diminta untuk memasukkan password.</p>

<p>Cara mengesetnya sangat mudah. Saya berasumsi bahwa kalian sudah mempartisi hard disk yang akan kalian gunakan sebagai media backup. Saya telah menyiapkan <strong>Partition 1</strong>, yang akan saya gunakan. Kemudian ikutin langkah-langkah di bawah.</p>

<p><img src="/assets/img/logo/logo_blank.svg" alt="" data-echo="/assets/Gambar 3.1.png" /></p>

<p>Gambar 3.1 - Format Partition</p>

<p>Pilih <strong>Partition 1</strong> â†’ <strong>klik Gear icon</strong> â†’ pilih <strong>Formation Partition</strong>.</p>

<p><img src="/assets/img/logo/logo_blank.svg" alt="" data-echo="/assets/Gambar 3.2.png" /></p>

<p>Gambar 3.2 - Format Volume Window (1)</p>

<p>Pilih <strong>Type : Encrypted, compatible with Linux systems (LUKS + Ext4</strong>).</p>

<p><img src="/assets/img/logo/logo_blank.svg" alt="" data-echo="/assets/Gambar 3.3.png" /></p>

<p>Gambar 3.3 - Format Volume Window (1)</p>

<p>Maka akan menampilkan form seperti di atas. Isi <strong>Name</strong> dan <strong>Passphrase</strong>. Lalu, pilih <strong>Format</strong>.</p>

<p><img src="/assets/img/logo/logo_blank.svg" alt="" data-echo="/assets/Gambar 3.4.png" /></p>

<p>Gambar 3.4 - Format Volume Window (3)</p>

<p>Muncul Pop Up Window yang menanyakan apakah kamu yakin ? Kalau yakin, pilih <strong>Format</strong>.</p>

<p><img src="/assets/img/logo/logo_blank.svg" alt="" data-echo="/assets/Gambar 3.5.png" /></p>

<p>Gambar 3.5 - Partition 1 dalam kondisi Unlocked</p>

<p><img src="/assets/img/logo/logo_blank.svg" alt="" data-echo="/assets/Gambar 3.6.png" /></p>

<p>Gambar 3.6 - Partition 1 dalam kondisi Locked</p>

<p>Sampai tahap ini, maka partisi kita telah siap untuk menjadi target media tempat kita menyimpan backup partisi root.</p>

<p>Sekarang kita akan melakukan backup. Terlebih dahulu, buka status Locked pada partisi yang sudah kita persiapkan. Dengan cara klik icon gembok yang terbuka. Apabila berhasil, Partition 1 akan terbagi menjadi 2 bagian, atas (Partition 1 LUKS) dan bawah (BACKUP-ROOT Ext4).</p>

<p>Kita akan menggunakan <code class="highlighter-rouge">rsync</code> untuk melakukan backup. Dengan beberapa parameter dan properties. Lihat contoh command di bawah.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo rsync -aAXvP --delete --exclude=dev --exclude=proc --exclude=sys --exclude=tmp --exclude=run --exclude=mnt --exclude=home/.ecryptfs / /run/media/archer/BACKUP-ROOT/
</code></pre></div></div>

<p>Perintah di atas dapat diartikan, kita akan menjalankan perintah <code class="highlighter-rouge">rsync</code> dengan <strong>tidak mengikutsertakan</strong> direktori-direktori berikut ini : <code class="highlighter-rouge">dev</code>, <code class="highlighter-rouge">proc</code>, <code class="highlighter-rouge">sys</code>, <code class="highlighter-rouge">tmp</code>, <code class="highlighter-rouge">run</code>, <code class="highlighter-rouge">mnt</code>, <code class="highlighter-rouge">home/.ecryptfs</code> dari <code class="highlighter-rouge">/</code> ke <code class="highlighter-rouge">/run/media/archer/BACKUP-ROOT/</code>.</p>

<p>Untuk details dari option <code class="highlighter-rouge">-aAXvP</code> dan <code class="highlighter-rouge">--delete</code>, dapat dibaca pada <code class="highlighter-rouge">man rsync</code>.</p>

<p>Proses ini akan memindahkan semua isi yang ada pada direktori <code class="highlighter-rouge">/</code> menuju direktori yang ada pada hard disk external kita yaitu <code class="highlighter-rouge">/run/media/archer/BACKUP-ROOT/</code>, tidak termasuk directory yang sudah kita tuliskan di atas.</p>

<p>Proses ini memakan waktu lama, bergantung pada seberapa banyak file yang ada pada direktori root <code class="highlighter-rouge">/</code> kalian. Sebaiknya pilih hard disk yang sudah menggakan teknologi USB 3.0 agar proses transfer data lebih cepat.</p>

<blockquote>
  <p><strong>Mengapa tidak mem-backup /home directory ?</strong></p>

  <p>Karena <code class="highlighter-rouge">/home</code> directory sudah terdapat di dalam directory <code class="highlighter-rouge">/</code>.</p>

  <p><strong>Mengapa mem-backup semua direktori pada /, tidak /home saja ?</strong></p>

  <p>Karena beberapa preferensi pribadi saya terdapat pada direktori <code class="highlighter-rouge">/etc</code> dan <code class="highlighter-rouge">/usr</code>.</p>
</blockquote>

<p>Kalian dapat menentukan direktoi-direktori apa saja yang tidak ingin ikut dibackup, tambahkan dengan cara <code class="highlighter-rouge">--exclude=namaDirektori</code>. Atau bahkan kalian ingin merubah source dan destination. Sangat bisa. Saya tidak mengharuskan untuk mengikuti preferensi saya.</p>

<p>Sampai pada tahap ini, langkah-langkah membuat backup telah selesai.</p>

<p>Kalian dapat membuat alias dari command di atas, agar tidak perlu menulis kembali command backup yang sangat panjang dan beresiko untuk typo.</p>

<p>Caranya tambahkan sebaris command alias pada <code class="highlighter-rouge">.bashrc</code> atau <code class="highlighter-rouge">.zshrc</code> (tergantung kalian pakai <code class="highlighter-rouge">shell</code> yang mana).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nano .bashrc
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
...

# BACKUP ENTIRE SYSTEM
alias backup-root=â€sudo rsync -aAXvP --delete --exclude=dev --exclude=proc --exclude=sys --exclude=tmp --exclude=run --exclude=mnt --exclude=home/.ecryptfs / /run/media/archer/BACKUP-ROOT/â€
</code></pre></div></div>

<p><code class="highlighter-rouge">backup-root</code> dapat kalian ganti sesuai keinginan. Maka, saat ingin melakukan backup, kalian tinggal menghubungkan hard disk dengan komputer/laptop â†’ masukkan password enkripsi â†’ buka Terminal â†’ ketikan backup-root.</p>

<h2 id="restore">Restore</h2>

<p>Setelah kita melakukan backup, langkah selanjutnya adalah mengerti bagaimana proses <em>restore</em>. Secara sederhana, dan memang sederhana, proses <em>restore</em> yang saya lakukan adalah meng-_copy_ direktori-direktori yang saya perlukan, satu persatu. Karena apabila saya melakukan instalasi ulang, sebisa mungkin saya menjaga bagaimana sistem tetap dalam keadaan <em>fresh</em> and <em>clean</em>. Hanya data-data tertentu dan saya inginkan saja yang saya <em>restore</em>. Sangat â€œramboâ€ dan manual sekali bukan. Hehehe</p>

<p>Mungkin kalian perlu melakukan <em>testing</em> terhadap file hasil backup sebelum <em>system</em> <em>failure</em> yang sebenarnya terjadi.</p>

<blockquote>
  <p>â€œ<em><strong>An untested backup is NOT backup !</strong></em>â€ â€“ Average Linux User.</p>
</blockquote>

<h2 id="recovery">Recovery</h2>

<p>Apabila terjadi <em>system failure</em>, yang saya lakukan adalah mengambil flash drive bootable berisi Arch Installer, dan melakukan seperti yang ada pada <strong>Step 3.1</strong> sampai <code class="highlighter-rouge">pacstrap</code> script saja. Kemudian <code class="highlighter-rouge">arch-chroot</code>, dan melakukan update. Atau sambil menunggu maintainer memperbaiki package yang <em>error</em> tersebut.</p>

<blockquote>
  <p>Sebuah keharusan untuk menyiapkan sendiri sebuah flash drive bootable berisi Arch Installer. Agar sewaktu-waktu apabila terjadi kegagalam sistem, kita dapat melakukan tindakan recovery.</p>
</blockquote>

<p>4 dari 5 system failure yang pernah saya alami selama 2 tahun menggunakan Arch Linux adalah karena terlalu sering melakukan update. Sedangkan package satu dengan package lain saling berketergantungan. Misal, package A dan B saling ketergantungan, namun package A sudah lebih dulu diupdate, sedangkan package B belum. Hal-hal seperti ini dapat saja dapat menyebabkan system failure saat kita melakukan reboot. Pas lagi apes-apesnya. Biasanya saya tunggu beberapa jam atau satu hari. Lalu saya lakukan <strong>Step 3.1 â†’ pacstrap â†’ arch-chroot â†’ update</strong>. Dan kebanyakan problem terselesaikan.</p>

<p>Banyak lagi hal-hal lain yang dapat menyebabkan <em>system failure</em>. Contoh dan metode di atas dapat saya katakan sebagai <strong>P3K</strong> (Pertolongan Pertama Pada Ke-error-an) yang terjadi pada sistem kita.</p>

<!-- NEXT PREV BUTTON -->
<div class="post-nav">
<a class="btn-blue-l" href="/arch/step-7-install-gnome-and-complete-installation"><img style="width:20px;" src="/assets/img/logo/logo_ap.png" /></a>
<a class="btn-blue-c" href="/arch/"><img style="width:20px;" src="/assets/img/logo/logo_menu.svg" /></a>
<a class="btn-blue-r" href="/arch/references"><img style="width:20px;" src="/assets/img/logo/logo_an.png" /></a>
</div>
:ET