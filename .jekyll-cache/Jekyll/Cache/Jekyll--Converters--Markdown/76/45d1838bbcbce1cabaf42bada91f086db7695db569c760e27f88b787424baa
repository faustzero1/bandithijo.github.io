I"m9<!-- BANNER OF THE POST -->
<!-- <img class="post&#45;body&#45;img" src="/assets/img/logo/logo_blank_banner.svg" data&#45;echo="#" alt="banner"> -->

<div class="blockquote-red">
<div class="blockquote-red-title">[ ! ] Perhatian</div>
<p>Lakukan <i>backup</i> data sebelum melakukan proses di bawah.</p>
<p>Segala bentuk kerugian, seperti kehilangan data maupun rusaknya perangkat yang kalian gunakan, bukan merupakan tanggung jawab penulis.</p>
<p><i>Do with Your Own Risk!</i></p>
</div>

<h1 id="prakata">Prakata</h1>

<p>Saya tidak akan berbasa-basi mengenai <em>privacy</em> di sini.</p>

<p>Saya yakin teman-teman yang tertarik dengan topik ini memiliki alasan dan kepentingan masing-masing.</p>

<p>Sebenarnya, saya sudah pernah menuliskan mengenai topik ini, namun terletak pada sub bab dari ebook proses instalasi Arch Linux pada UEFI firmware yang saya tulis <a href="https://bandithijo.com/arch/step-7-install-gnome-and-complete-installation#710-encrypt-home-directory" target="_blank">di sini</a>.</p>

<p>Karena tidak aksesible banget, jadi saya memutuskan untuk membuat post tersendiri.</p>

<h1 id="mengenkripsi-home-direktori">Mengenkripsi Home Direktori</h1>

<div class="blockquote-red">
<div class="blockquote-red-title">[ ! ] Perhatian</div>
<p>
Saya sangat merekomendasikan untuk tidak menerapkan proses enkripsi ini pada Home direktori yang sudah terisi penuh dengan banyak file.</p>
<p>Karena, proses pengenkripsian file-file yang ada didalam direktori Home akan memakan waktu yang sangat lama dan akan menambah kapasitas hardisk menjadi 2x Home (direktori Home lama + direktori Home baru).</p>
<br />
<p>Saya menyarankan untuk membuat user baru saja.</p>
<p>Best practicenya memang biasa saya terapkan pada saat awal instalasi sistem operasi.</p>
</div>

<p>Proses mengenkripsi Home direktori ini akan saya bagi dalam beberapa tahapan, agar teman-teman mudah untuk memahami dan mudah memetakan apabila nanti akan mengajukan pertanyaan atau pembahasan saat berdiskusi.</p>

<p>Oke, berikut ini adalah sekenarionya.</p>

<h2 id="instalasi-paket-paket-yang-diperlukan">Instalasi Paket-paket yang Diperlukan</h2>

<p>Kita memerlukan paket tambahan yang wajib dipasang untk melakukan proses enkripsi.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pacman -S ecryptfs-utils lsof
</code></pre></div></div>

<p>Yak! Sudah bisa ditebak, paket yang saya gunakan untuk mengenkripsi Home direktori adalah <strong>eCryptfs</strong>.</p>

<p><strong>Kenapa menggunkan eCryptfs?</strong></p>

<p>Karena praktis. Tidak memerlukan partisi yang berbeda untuk memasang (<em>mounting</em>) direktori yang kita enkripsi. Proses dekripsi file-file yang ada pada direktori yang terenkripsi akan dimounting ke dalam satu direktori yang sudah kita tentukan.</p>

<p>Saya memerlukan paket <code class="highlighter-rouge">lsof</code> untuk mendeteksi apakah masih terdapat proses yang berjalan (<em>running</em>) pada user tertentu pada saat berada di TTY.</p>

<p>Setelah kedua paket yang kita perlukan telah selesai dipasang, langkah selanjutnya adalah menambahkannya pada kernel module.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo modprobe ecryptfs
</code></pre></div></div>

<p>Apabila tidak menampilkan <em>error</em>, artinya perintah di atas telah berhasil.</p>

<p>Tahap selanjutnya kita akan masuk ke dalam TTY shell.</p>

<p>Oke, langsung saja kita eksekusi.</p>

<h2 id="login-root-dengan-tty-shell">Login Root dengan TTY Shell</h2>

<ol>
  <li>
    <p>Langkah pertama, kita perlu <strong>logout</strong> dari sistem.</p>

    <p>Jadi, teman-teman yang berniat mengenkripsi Home direktorinya, perlu membuka post blog ini menggunakan <em>smartphone</em>.</p>
  </li>
  <li>
    <p>Masuk ke TTY shell, bisa TTY2 - TTY6, pilih saja mana yang menampilkan login shell seperti di bawah ini.</p>

    <p>Cara masuk dan berpindah antar TTY, gunakan <kbd>CTRL</kbd>+<kbd>ALT</kbd>+<kbd>F2</kbd> untuk TTY2. <kbd>F3</kbd> untuk TTY3, dan begitu seterusnya.</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Arch Linux 5.1.9-arch1-1-ARCH (tty6)

 BANDITHIJO-X61 login: root
 Password: _
</code></pre></div>    </div>
    <p>Apabila sudah masuk ke TTY, login dengan akun <strong>root</strong>.</p>
  </li>
  <li>
    <p>Setelah berhasil login dengan akun root, lakukan pengecekan apakah user yang kamu gunakan tadi masih memiliki proses yang berjalan (<em>running process</em>).</p>

    <pre>
# ps -U <mark>bandithijo</mark></pre>

    <p>Ganti <mark>bandithijo</mark> dengan username yang kamu gunakan, yang ingin dienkripsi Home direktorinya.</p>

    <p>Apabila perintah di atas menampilkan <em>output</em> seperti di bawah ini.</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> PID  TTY      TIME  CMD

</code></pre></div>    </div>
    <p>Artinya, sudah tidak lagi terdapat proses yang <em>running</em> pada user tersebut.</p>

    <p>Dengan begini, kita dapat lanjut ke tahap berikutnya.</p>
  </li>
</ol>

<h2 id="migrasi-home-dengan-enkripsi">Migrasi Home dengan Enkripsi</h2>

<ol>
  <li>
    <p>Perintah di bawah ini akan memigrasikan atau membuat salinan (<em>cloning</em>) dari Home direktori kalian namun dalam bentuk yang sudah terenkripsi.</p>

    <pre>
# ecryptfs-migrate-home -u <mark>bandithijo</mark></pre>

    <p>Jangan lupa untuk mengganti <mark>bandithijo</mark> dengan nama username dari user yang Home direktorinya ingin teman-teman enkripsi.</p>

    <p>Perintah di atas, akan menghasilkan <em>output</em> seperti di bawah ini.</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> INFO: Checking disk space, this may take a few minutes. Please be patient.
 INFO: Checking for open files in /home/bandithijo

 Enter your login passphrase [bandithijo]: _
</code></pre></div>    </div>

    <div class="blockquote-red">
 <div class="blockquote-red-title">[ ! ] Perhatian</div>
 <p>Masukkan <b>password</b> yang sama dengan <b>login password username</b> kalian.</p>
 </div>

    <p>Perhatikan dengan seksama <em>output</em> tersebut.</p>

    <p>Kita diminta memasukkan <strong><em>passphrase</em></strong> atau <strong><em>password</em></strong> yang sama seperti password username kita.</p>

    <p>Tujuannya agar saat kita login menggunakan username kita, secara otomatis <strong>eCryptfs</strong> akan mendekripsi direktori <code class="highlighter-rouge">/home/username</code> yang terenkripsi.</p>

    <p>Proses ini akan memakan <del>sedikit</del> waktu, tergantung dari banyaknya file yang terdapat di dalam Home direktori yang dienkripsi.</p>
  </li>
  <li>
    <p>Setelah proses enkripsi selesai, kita dapat <em>logout</em> (<strong>jangan *reboot</strong>).</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># exit
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="pengetesan-dekrip-home-direktori">Pengetesan Dekrip Home Direktori</h2>

<p>Setelah kita melakukan enkripsi Home direktori, tentunya kita ingin melakukan pengetesan apakah proses enkripsi terhadap Home direktori yang kita lakukan telah berhasil.</p>

<ol>
  <li><em>Login</em> kembali menggunakan user yang Home direktorinya baru saja kita enkripsi.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Arch Linux 5.1.9-arch1-1-ARCH (tty6)

 BANDITHIJO-X61 login: &amp;lt;mark&amp;gt;bandithijo&amp;lt;/mark&amp;gt;
 Password: _
</code></pre></div>    </div>
  </li>
  <li>Jalankan perintah di bawah untuk mendekripsi Home direktori (sekaligus me-<em>mounting</em>-nya).
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ ecryptfs-mount-private
</code></pre></div>    </div>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Enter your login passphrase: _
</code></pre></div>    </div>

    <p>Masukkan <em>password</em> yang sudah kita buat sama dengan <em>login password user</em> kita.</p>

    <p>Perintah di atas akan mendekripsi Home direktori.</p>
  </li>
  <li>
    <p>Sekarang coba lakukan pengetesan dengan perintas <code class="highlighter-rouge">ls</code>.</p>

    <pre>
$ ls -la /home/<mark>bandithijo</mark></pre>

    <p>Jangan lupa mengganti <mark>bandithijo</mark> dengan nama username kalian.</p>

    <p>Nama username juga berarti nama direktori dari Home user tersebut.</p>

    <div class="blockquote-blue">
 <div class="blockquote-blue-title">[ i ] Informasi</div>
 <p>Kita perlu mencatat kunci simetris 128-bit value yang kita gunakan untuk mengenkripsi/dekripsi. </p>
 <pre>
$ ecryptfs-unwrap-passphrase</pre>
 <pre>
Passphrase: _</pre>
 <p>Masukkan <i>login password</i> yang juga menjadi <i>password dekripsi</i> dari Home direktori.</p>
 <p>Apabila benar, kira-kira hasilnya akan seperti ini.</p>
 <pre>
c17510cc56hj093gj7930lkfip3vn24g</pre>
 Bentuknya mirip MD5 hash, tapi bukan.
 <br />
 <p>Catat pada secarik kertas dan simpan baik-baik.</p>
 <p>Kita akan gunakan kembali untuk me-<i>recovery</i> Home direktori yang terenkripsi pada kasus misalkan <code>wrapped-passphrase</code> tidak sengaja terhapus atau <i>corrupted</i> atau bahkan kalian lupa <i>login password</i>.</p>
 </div>
  </li>
  <li>
    <p>Selanjutnya lakukan pengecekan keberadaan dari file-file berikut ini.</p>

    <pre>
$ ls .ecryptfs</pre>

    <pre>
<mark>auto-mount</mark> <mark>auto-unmount</mark> Private.mnt Private.sig <mark>wrapped-passphrase</mark></pre>

    <p>Pastikan file-file yang saya marking kuning.</p>

    <p>File-file tersebut harus ada pada direktori <code class="highlighter-rouge">.ecryptfs</code></p>

    <p>Direktori ini merupakan <em>symbolic link</em> dari <code class="highlighter-rouge">/home/.ecryptfs/bandithijo/.ecryptfs/</code></p>
  </li>
</ol>

<h2 id="memberikan-ecryptfs-akses-pam">Memberikan eCryptfs Akses PAM</h2>

<p>Pada langkah sebelumnya kita sudah berhasil men-dekripsi Home direktori kita.</p>

<p>Namun, kalau diperhatikan, proses dekripsi tersebut tidak otomatis dilakukan bersamaan dengan saat kita <em>login</em>.</p>

<p>Sedangkan, pasti kita mau proses yang praktis.</p>

<p>Untuk mengatasi masalah ini sangat mudah. Tinggal kita tambahkan beberapa baris aturan (<em>rules</em>) pada file konfigurasi PAM.</p>

<ol>
  <li>
    <p>Gunakan <em>text editor</em> favorit kalian untuk mengedit file di bawah ini.</p>

    <pre>
$ sudo vim /etc/pam.d/system-auth</pre>

    <pre>
#%PAM-1.0<br />
auth      required  pam_unix.so     try_first_pass nullok
<mark>auth      required  pam_ecryptfs.so unwrap</mark>
auth      optional  pam_permit.so
auth      required  pam_env.so<br />
account   required  pam_unix.so
account   optional  pam_permit.so
account   required  pam_time.so<br />
<mark>password  optional  pam_ecryptfs.so</mark>
password  required  pam_unix.so     try_first_pass nullok sha512 shadow
password  optional  pam_permit.so<br />
session   required  pam_limits.so
session   required  pam_unix.so
<mark>session   optional  pam_ecryptfs.so unwrap</mark>
session   optional  pam_permit.so</pre>

    <p>Tambahkan tiga baris yang saya <em>marking</em> kuning sesuai posisinya.</p>

    <p><strong>Pastikan benar-benar tidak ada yang <em>typo</em>!</strong></p>
  </li>
  <li>
    <p>Simpan dan keluar dari <em>text editor</em>.</p>
  </li>
  <li>
    <p><em>Reboot</em> dan <em>login</em>.</p>

    <p>Pastikan kalian dapat masuk ke dalam desktop kalian.</p>
  </li>
  <li>
    <p>Apabila berhasil, tinggal periksa, apakah isi dari Home direktori kita berhasil di-<em>mouting</em> atau tidak.</p>
  </li>
</ol>

<h2 id="menghapus-direktori-home-backup">Menghapus Direktori Home Backup</h2>

<p>Saat kita melakukan tahap pertama, yaitu tahap migrasi atau mengenkripsi Home direktori, proses yang terjadi adalah Home direktori kita akan disalin dalam bentuk terenkripsi ke dalam direktori <code class="highlighter-rouge">/home/.ecryptfs/bandithijo/.Private</code> dan Home direktori lama kita akan di-<em>rename</em> menjadi <code>/home/bandithijo.<mark>p7o6p7R2</mark></code>. Sedangkan direktori <code class="highlighter-rouge">/home/bandithijo</code> akan menjadi direktori kosong sebagai tempat untuk <em>mounting</em> pada saat proses dekripsi.</p>

<p>Bagian yang saya <em>marking</em> kuning adalah deretan karakter random yang di-<em>generate</em> oleh eCryptfs pada saat proses migrasi Home direktori.</p>

<p>Coba lakukan pemeriksaan isi dari Home direktori kita.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -a /home
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bandithijo bandithijo.p7o6p7R2 .ecryptfs
</code></pre></div></div>

<p>Nah, kita perlu menghapus direktori <code class="highlighter-rouge">bandithijo.p7o6p7R2</code> tersebut.</p>

<p>Karena sudah tidak lagi kita gunakan.</p>

<p>Penjelasan mudahnya, direktroi ini adalah Home direktori lama kita yang sudah di-<em>rename</em> oleh eCryptfs pada saat proses Home migrasi.</p>

<p>Kita dapat menghapusnya dengan aman.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo rm -rvf bandithijo.p7o6p7R2
</code></pre></div></div>

<p>Tunggu proses penghapusan sampai selesai.</p>

<p>Dengan begini, proses enkripsi Home direktori kita telah selesai.</p>

<p>Apabila teman-teman ingin mengganti <em>password</em> dari user yang berarti juga harus mengganti <em>passphrase</em> dari Home direktori yang terenkripsi, silahkan mengunjungi tulisan saya yang ini, “<a href="https://bandithijo.com/blog/mengganti-password-user-dari-home-direktori-yang-terenkripsi" target="_blank">Mengganti Password User dari Home Direktori yang Terenkripsi</a>”.</p>

<h1 id="pesan-penulis">Pesan Penulis</h1>

<p>Tulisan ini bukan merupakan tandingan dari dokumentasi eCryptfs. Silahkan merujuk pada dokumentasi eCryptfs resmi yang sudah saya sertakan pada bagian referensi di bawah.</p>

<p>Dapat pula teman-teman yang menggunakan Arch Linux, merujuk pada Arch Wiki eCryptfs yang sudah saya sertakan di bawah.</p>

<p>Sepertinya seperti ini saja.</p>

<h1 id="referensi">Referensi</h1>

<ol>
  <li>
    <p><a href="https://bandithijo.com/arch/step-7-install-gnome-and-complete-installation#710-encrypt-home-directory" target="_blank">bandithijo.com/arch/step-7-install-gnome-and-complete-installation#710-encrypt-home-directory</a>
<br />Diakses tanggal: 2019/06/14</p>
  </li>
  <li>
    <p><a href="https://wiki.archlinux.org/index.php/ECryptfs" target="_blank">wiki.archlinux.org/index.php/ECryptfs</a>
<br />Diakses tanggal: 2019/06/14</p>
  </li>
</ol>

:ET